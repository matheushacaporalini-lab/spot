<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Spotify HUD</title>
  <style>
    body { background: #121212; font-family: Arial; color: white; margin: 0; padding: 20px; }
    .hud { display: flex; align-items: center; gap: 10px; }
    img { border-radius: 8px; width: 64px; height: 64px; object-fit: cover; }
    .info { display: flex; flex-direction: column; }
    .title { font-weight: bold; font-size: 18px; }
    .next { font-size: 14px; opacity: 0.7; }
    button { margin-top: 5px; padding: 6px 12px; background: #1DB954; color: white; border: none; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="hud">
    <img id="cover" style="display:none;">
    <div class="info">
      <div class="title" id="current">Conecte-se ao Spotify ðŸŽ¶</div>
      <div class="next" id="next"></div>
      <button onclick="login()">Conectar</button>
    </div>
  </div>

  <script>
    const CLIENT_ID = "a7dc3a0b956940e0ba15c536d68fa56d";
    const REDIRECT_URI = "http://192.168.56.1:8800/callback";
    const SCOPES = "user-read-currently-playing user-read-playback-state";

    let lastTrackId = null;

    function login() {
      const url = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(SCOPES)}`;
      window.location.href = url;
    }

    function getTokenFromUrl() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      return params.get("access_token");
    }

    async function getCurrentlyPlaying(token) {
      const res = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (res.status === 204) {
        document.getElementById("current").textContent = "Nenhuma mÃºsica tocando.";
        return;
      }
      const data = await res.json();
      if (!data.item) return;

      if (data.item.id !== lastTrackId) {
        lastTrackId = data.item.id;
        document.getElementById("current").textContent = `${data.item.name} - ${data.item.artists[0].name}`;
        document.getElementById("cover").src = data.item.album.images[0].url;
        document.getElementById("cover").style.display = "block";
      }
    }

    async function getQueue(token) {
      const res = await fetch("https://api.spotify.com/v1/me/player/queue", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      if (data.queue.length > 0) {
        document.getElementById("next").textContent = `PrÃ³xima: ${data.queue[0].name} - ${data.queue[0].artists[0].name}`;
      }
    }

    window.onload = async () => {
      const token = getTokenFromUrl();
      if (token) {
        setInterval(() => {
          getCurrentlyPlaying(token);
          getQueue(token);
        }, 5000);
      }
    }
  </script>
</body>
</html>
